(()=>{"use strict";var e,t=function(e){document.removeEventListener("keydown",n),document.removeEventListener("click",o),e.classList.remove("popup_opened")},r=function(){return document.querySelector(".popup_opened")},n=function(e){"Escape"===e.key&&t(r())},o=function(e){var n=e.target.classList;(n.contains("popup")||n.contains("popup__close-button"))&&t(r())},c=function(e){document.addEventListener("keydown",n),document.addEventListener("click",o),e.classList.add("popup_opened")},a=function(e,t){return Array.from(e.querySelectorAll(t))},i=function(e,t){return e.forEach((function(e){return e.classList.remove(t)}))},l=function(e,t,r){var n=e.querySelector(r.buttonSelector);!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?function(e,t){e.classList.remove(t.buttonDisabledClass),e.disabled=!1}(n,r):function(e,t){e.classList.add(t.buttonDisabledClass),e.disabled=!0}(n,r)},u={templateSelector:"#card-template",cardSelector:".cards__list-item",imageSelector:".cards__picture",nameSelector:".cards__title",likeClass:"cards__like-button",likeSelector:".cards__like-button",likeActiveClass:"cards__like-button_active",likeCountSelector:".cards__like-count",deleteClass:"cards__delete-button",deleteSelector:".cards__delete-button",deleteVisibleClass:"cards__delete-button_visible",imageOverlayClass:"cards__overlay",popupViewerSelector:"#image-viewer-popup",popupViewerImageSelector:".image-viewer__picture",popupViewerDescriptionSelector:".image-viewer__caption"},s=document.querySelector(".profile__title"),d=document.querySelector(".profile__subtitle"),f=document.querySelector(".profile__edit-button"),p=document.querySelector("#edit-popup"),m=p.querySelector(".form"),v=p.querySelector("#title"),S=p.querySelector("#job"),_=m.querySelector(".form__button"),h=document.querySelector(".cards__list"),y=document.querySelector(".profile__add-button"),b=document.querySelector("#add-popup"),C=b.querySelector(".form"),k=b.querySelector("#name-card"),g=b.querySelector("#link-img-card"),q=b.querySelector(".form__button"),L=document.querySelector(".profile__avatar"),E=document.querySelector("#edit-avatar-popup"),w=E.querySelector(".form"),A=E.querySelector("#url-avatar"),x=E.querySelector(".form__button"),D=document.querySelector("#confirm-action"),I=D.querySelector(".form"),O=D.querySelector(".form__button"),P={formSelector:".form",inputSelector:".form__input",errorClass:"form__input-error-message_visible",errorSelector:".form__input-error-message_visible",inputInvalidClass:"form__input_invalid",inputInvalidSelector:".form__input_invalid",buttonSelector:".form__button",buttonDisabledClass:"form__button_disabled"},V={urlProfile:"https://nomoreparties.co/v1/plus-cohort-8/users/me",urlCards:"https://nomoreparties.co/v1/plus-cohort-8/cards",urlLikes:"https://nomoreparties.co/v1/plus-cohort-8/cards/likes",urlAvatar:"https://nomoreparties.co/v1/plus-cohort-8/users/me/avatar ",headers:{"Content-type":"application/json",authorization:"45def5a2-c1e5-4149-8cae-fca78747b383"}},T=function(e){return e.ok?e.json():Promise.reject(e)},j=function(e,t,r,n,o,c){var a=document.querySelector(c.templateSelector).content.querySelector(c.cardSelector).cloneNode(!0),i=a.querySelector(c.imageSelector),l=a.querySelector(c.nameSelector),u=a.querySelector(c.likeSelector),d=a.querySelector(c.likeCountSelector),f=a.querySelector(c.deleteSelector);return a.setAttribute("data-id",e),a.setAttribute("data-owner-id",t),i.src=n,i.alt=r,l.textContent=r,d.textContent=o.length,function(e){return e.some((function(e){return e._id===s.getAttribute("data-owner-id")}))}(o)&&u.classList.add(c.likeActiveClass),function(e){return e===s.getAttribute("data-owner-id")}(t)&&f.classList.add(c.deleteVisibleClass),a},N=function(e,t){switch(e){case"appendSomeCards":t.forEach((function(e){return h.append(e)}));break;case"prependOneCard":h.prepend(t);break;default:console.log("Insert type ".concat(e," not in select"))}},J=function(e,t,r,n){var o,c;e.textContent=r.likes.length,o=t,c=n.likeActiveClass,o.classList.toggle(c)},H=function(e,t,r){var n=e.target,o=n.parentElement;switch(n.classList[0]){case t.imageOverlayClass:!function(e,t){var r=document.querySelector(t.popupViewerSelector),n=r.querySelector(t.popupViewerImageSelector),o=r.querySelector(t.popupViewerDescriptionSelector),a=e.querySelector(t.imageSelector);n.src=a.src,n.alt=a.alt,o.textContent=a.alt,c(r)}(n,t);break;case t.likeClass:!function(e,t,r){var n=e.parentElement.parentElement.parentElement,o=n.getAttribute("data-id"),c=n.querySelector(t.likeSelector),a=n.querySelector(t.likeCountSelector);!function(e,t){return e.classList.contains(t)}(e,t.likeActiveClass)?function(e,t){return fetch("".concat(t.urlLikes,"/").concat(e),{method:"PUT",headers:t.headers}).then(T)}(o,r).then((function(e){J(a,c,e,t)})).catch((function(e){return console.log(e)})):function(e,t){return fetch("".concat(t.urlLikes,"/").concat(e),{method:"DELETE",headers:t.headers}).then(T)}(o,r).then((function(e){J(a,c,e,t)})).catch((function(e){return console.log(e)}))}(n,t,r);break;case t.deleteClass:O.setAttribute("data-card-id",o.getAttribute("data-id")),c(D)}},z=function(e,t){e.textContent=t,e.disabled=!0},M=function(e){var t=a(e,P.errorSelector),r=a(e,P.inputInvalidSelector);i(t,P.errorClass),i(r,P.inputInvalidClass)};f.addEventListener("click",(function(){v.value=s.textContent,S.value=d.textContent,M(p),l(p,[v,S],P),c(p)})),y.addEventListener("click",(function(){C.reset(),M(b),l(b,[k,g],P),c(b)})),L.addEventListener("click",(function(){w.reset(),M(E),l(E,[A],P),c(E)})),h.addEventListener("click",(function(e){return H(e,u,V)})),m.addEventListener("submit",(function(e){var r,n;e.preventDefault(),z(_,"Сохранение..."),(r={name:v.value,about:S.value},n=V,fetch("".concat(n.urlProfile),{method:"PATCH",headers:n.headers,body:JSON.stringify(r)}).then(T)).then((function(e){s.textContent=e.name,d.textContent=e.about,t(p)})).catch((function(e){return console.log(e)})).finally((function(){return z(_,"Сохранение")}))})),C.addEventListener("submit",(function(e){var r,n;e.preventDefault(),z(q,"Сохранение..."),(r={name:k.value,link:g.value},n=V,fetch("".concat(n.urlCards),{method:"POST",headers:n.headers,body:JSON.stringify(r)}).then(T)).then((function(e){var r=j(e._id,e.owner._id,e.name,e.link,e.likes,u);N("prependOneCard",r),t(b)})).catch((function(e){return console.log(e)})).finally((function(){return z(q,"Создать")}))})),w.addEventListener("submit",(function(e){var r,n;e.preventDefault(),z(x,"Сохранение..."),(r={avatar:A.value},n=V,fetch("".concat(n.urlAvatar),{method:"PATCH",headers:n.headers,body:JSON.stringify(r)}).then(T)).then((function(e){L.style.backgroundImage="url(".concat(e.avatar,")"),t(E)})).catch((function(e){return console.log(e)})).finally((function(){return z(x,"Сохранить")}))})),I.addEventListener("submit",(function(e){return function(e,r,n){e.preventDefault(),O.textContent="Удаление...",O.disabled=!0,function(e,t){return fetch("".concat(t.urlCards,"/").concat(e),{method:"DELETE",headers:t.headers}).then(T)}(r,n).then((function(){document.querySelector('[data-id="'.concat(r,'"]')).remove(),t(D)})).catch((function(e){return console.log(e)})).finally((function(){return O.textContent="Да"}))}(e,O.getAttribute("data-card-id"),V)})),e=P,a(document,e.formSelector).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var r=a(e,t.inputSelector);r.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,r){var n=e.querySelector("#error-".concat(t.id));t.validity.valid?function(e,t,r){e.classList.remove(r.inputInvalidClass),t.classList.remove(r.errorClass),t.textContent=""}(t,n,r):function(e,t,r,n){e.classList.add(n.inputInvalidClass),t.classList.add(n.errorClass),t.textContent=r}(t,n,t.validationMessage,r)}(e,n,t),l(e,r,t)}))}))}(t,e)})),function(e){return fetch("".concat(e.urlProfile),{headers:e.headers}).then(T)}(V).then((function(e){L.style.backgroundImage="url(".concat(e.avatar),s.textContent=e.name,s.setAttribute("data-owner-id",e._id),d.textContent=e.about})).catch((function(e){return console.log(e)})),function(e){return fetch("".concat(e.urlCards),{headers:e.headers}).then(T)}(V).then((function(e){var t=e.map((function(e){return j(e._id,e.owner._id,e.name,e.link,e.likes,u)}));N("appendSomeCards",t)})).catch((function(e){return console.log(e)}))})();